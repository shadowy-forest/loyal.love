#!/bin/bash


source "$(dirname "$(realpath "$0")")/../utils.sh"

log "ğŸ‘¾ post-commit hook starting..."

SCRIPT_DIR="$(dirname "$(realpath "$0")")"
REPO_ROOT="$(git rev-parse --show-toplevel)"
cd "$REPO_ROOT"

if [ -f "scripts/generate_rss.sh" ]; then
    log "updating rss feed..."
    chmod +x scripts/generate_rss.sh scripts/generate_rss.py
    python3 -m pip install -r requirements.txt
    generate_rss

    if git diff --quiet rss.xml; then
        log "ğŸ‘¾ no changes to rss feed."
    else
        log "ğŸ‘¾ rss feed updated. committing changes..."
        git add rss.xml
        git commit -m "chore: update rss feed" --no-verify
        log "ğŸ‘¾ rss feed changes committed."
    fi
else
    log "âŒ rss feed generation script not found at scripts/generate_rss.sh"
fi

log "ğŸ‘¾ running make lint..."
run_lint

log "ğŸ‘¾ running make clean..."
run_clean

success "âœ… post-commit hook completed at $(date)\n"
