#!/bin/bash


source "$(dirname "$(realpath "$0")")/../utils.sh"

log "ðŸ‘¾ post-commit hook starting..."

SCRIPT_DIR="$(dirname "$(realpath "$0")")"
REPO_ROOT="$(git rev-parse --show-toplevel)"
cd "$REPO_ROOT"

log "updating rss feed..."
python3 -m pip install -r requirements.txt
generate_rss

if git diff --quiet rss.xml; then
    log "ðŸ‘¾ no changes to rss feed."
else
    log "ðŸ‘¾ rss feed updated. committing changes..."
    git add rss.xml
    git commit -m "chore: update rss feed" --no-verify
    log "ðŸ‘¾ rss feed changes committed."
fi

log "ðŸ‘¾ running make lint..."
run_lint

log "ðŸ‘¾ running make clean..."
run_clean

success "âœ… post-commit hook completed at $(date)\n"
